version: '3.8'

services:
  vitepress-build:
    # 使用 Dockerfile 构建镜像
    build:
      context: . # 使用当前目录的 Dockerfile
    container_name: vitepress-build
    volumes:
      - ./docs:/usr/src/app/docs
      - ./node_modules:/usr/src/app/node_modules
    ports:
      - "3000:3000" # 映射本地端口到容器
    environment:
      - NODE_ENV=development
    command: ["npm", "run", "dev"]  # 启动 VitePress 开发环境

  nginx:
    image: nginx:alpine
    container_name: vitepress-nginx
    volumes:
      - ./docs/.vitepress/dist:/usr/share/nginx/html:ro # 使用 VitePress 构建后的静态文件
    ports:
      - "80:80"  # 将容器的 80 端口映射到宿主机的 80 端口
    depends_on:
      - vitepress-build  # 确保 vitepress-build 完成后再启动 Nginx
    restart: always
